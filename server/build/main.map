{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/auth/index.js","webpack:///./src/auth/router.js","webpack:///./src/auth/store.js","webpack:///./src/index.js","webpack:///./src/products/index.js","webpack:///./src/products/router.js","webpack:///./src/products/store.js","webpack:///./src/user/index.js","webpack:///./src/user/router.js","webpack:///./src/utils/constants.js","webpack:///./src/utils/index.js","webpack:///./src/utils/middlewares.js","webpack:///external \"@koa/cors\"","webpack:///external \"@panderalabs/koa-pageable\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"nedb-promise\""],"names":["router","Router","createToken","user","jwt","sign","username","_id","jwtConfig","secret","expiresIn","createUser","response","userStore","insert","body","token","status","err","issue","error","message","post","ctx","credentials","request","findUser","findOne","findEmail","email","Error","password","UserStore","constructor","filename","autoload","store","dataStore","find","props","update","note","remove","app","Koa","use","cors","exceptionHandler","timingLogger","bodyParser","prefix","publicApiRouter","authRouter","routes","allowedMethods","protectedApiRouter","productRouter","userRouter","listen","console","log","get","paginate","result","productStore","product","params","id","createProduct","put","productId","updatedCount","del","ProductStore","productName","name","userId","next","start","Date","now","method","url"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export * from './router'\r\n","import Router from 'koa-router';\r\nimport userStore from './store';\r\nimport jwt from 'jsonwebtoken';\r\nimport { jwtConfig } from '../utils';\r\n\r\nexport const router = new Router();\r\n\r\nconst createToken = (user) => {\r\n  return jwt.sign({ username: user.username, _id: user._id }, jwtConfig.secret, { expiresIn: 60 * 60 * 60 });\r\n};\r\n\r\nconst createUser = async (user, response) => {\r\n  try {\r\n    await userStore.insert(user);\r\n    response.body = { token: createToken(user) };\r\n    response.status = 201; // created\r\n  } catch (err) {\r\n    response.body = { issue: [{ error: err.message }] };\r\n    response.status = 400; // bad request\r\n  }\r\n};\r\n\r\nrouter.post('/signup', async (ctx) => {\r\n  let credentials = ctx.request.body;\r\n  let findUser = await userStore.findOne({ username: credentials.username });\r\n  let findEmail = await userStore.findOne({email: credentials.email});\r\n\r\n  if (findUser) {\r\n    throw new Error('This username already exists!')\r\n  }\r\n\r\n  if (findEmail) {\r\n    throw new Error('This email already exists!')\r\n  }\r\n\r\n  if (!(credentials.username && credentials.password && credentials.email)) {\r\n    throw new Error('Username and Password required!')\r\n  }\r\n\r\n  await createUser(ctx.request.body, ctx.response)\r\n\r\n});\r\n\r\nrouter.post('/login', async (ctx) => {\r\n  const credentials = ctx.request.body;\r\n  const response = ctx.response;\r\n  const user = await userStore.findOne({ username: credentials.username });\r\n  if (user && credentials.password === user.password) {\r\n    response.body = { token: createToken(user) };\r\n    response.status = 201; // created\r\n  } else {\r\n    response.body = { issue: [{ error: 'Invalid credentials' }] };\r\n    response.status = 400; // bad request\r\n  }\r\n});\r\n","import dataStore from 'nedb-promise';\r\n\r\nexport class UserStore {\r\n  constructor({ filename, autoload }) {\r\n    this.store = dataStore({ filename, autoload });\r\n  }\r\n\r\n  async find(props) {\r\n    return this.store.find(props);\r\n  }\r\n\r\n  async findOne(props) {\r\n    return this.store.findOne(props);\r\n  }\r\n\r\n  async insert(user) {\r\n    return this.store.insert(user);\r\n  };\r\n\r\n  async update(props, note) {\r\n    return this.store.update(props, note);\r\n  }\r\n\r\n  async remove(props) {\r\n    return this.store.remove(props);\r\n  }\r\n\r\n}\r\n\r\nexport default new UserStore({ filename: './db/users.json', autoload: true });\r\n","import Koa from 'koa';\r\nimport Router from 'koa-router';\r\nimport bodyParser from \"koa-bodyparser\";\r\nimport {timingLogger, exceptionHandler, jwtConfig} from './utils';\r\nimport {router as productRouter} from './products';\r\nimport {router as authRouter} from './auth';\r\nimport {router as userRouter} from './user';\r\nimport jwt from 'koa-jwt';\r\nimport cors from '@koa/cors';\r\n\r\nconst app = new Koa();\r\n\r\napp.use(cors())\r\napp.use(exceptionHandler);\r\napp.use(timingLogger);\r\napp.use(bodyParser());\r\n\r\nconst prefix = '/api';\r\n\r\n// public\r\nconst publicApiRouter = new Router({prefix});\r\npublicApiRouter\r\n    .use('/auth', authRouter.routes());\r\napp\r\n    .use(publicApiRouter.routes())\r\n    .use(publicApiRouter.allowedMethods());\r\n\r\napp.use(jwt(jwtConfig));\r\n\r\n// protected\r\nconst protectedApiRouter = new Router({ prefix });\r\nprotectedApiRouter\r\n    .use('/products', productRouter.routes())\r\n    .use('/users', userRouter.routes());\r\n\r\napp\r\n    .use(protectedApiRouter.routes())\r\n    .use(protectedApiRouter.allowedMethods());\r\n\r\napp.listen(8008);\r\nconsole.log('koa-server started on port 8008');\r\n","export * from './router'\n","import { Pageable, IndexablePage, paginate } from '@panderalabs/koa-pageable';\nimport Router from 'koa-router';\nimport productStore from './store';\n\nexport const router = new Router();\n\nrouter.get('/', paginate, async (ctx) => {\n    ctx.body = result;\n    const response = ctx.response;\n\n    response.body = await productStore.find({});\n    response.status = 200; // ok\n\n\n    // const pageable: Pageable = ctx.state.pageable;\n    //\n    // const result: IndexablePage<number, Person> = service.getData(pageable);\n    //\n    // ctx.body = result;\n});\n\nrouter.get('/:id', async (ctx) => {\n    const product = await productStore.findOne({ _id: ctx.params.id });\n    const response = ctx.response;\n    if (product) {\n        response.body = product;\n        response.status = 200; // ok\n    } else {\n        response.status = 404; // not found\n    }\n});\n\nconst createProduct = async (product, response) => {\n    try {\n        response.body = await productStore.insert(product);\n        response.status = 201; // created\n    } catch (err) {\n        response.body = { issue: [{ error: err.message }] };\n        response.status = 400; // bad request\n    }\n};\n\nrouter.post('/', async (ctx) => await createProduct(ctx.request.body, ctx.response));\n\n// router.put('/:id', async (ctx) => {\n//     const product = ctx.request.body;\n//     const productId = ctx.params.id;\n//     const response = ctx.response;\n//     try {\n//         const updatedproduct = await productStore.update({ _id: productId }, product);\n//         console.log(updatedproduct)\n//         response.body = updatedproduct;\n//         response.status = 200;\n//     } catch (err) {\n//         response.body = { issue: [{ error: err.message }] };\n//         response.status = 400; // bad request\n//     }\n// });\n\nrouter.put('/:id', async (ctx) => {\n    const product = ctx.request.body;\n    const id = ctx.params.id;\n    const productId = product._id;\n    const response = ctx.response;\n    if (productId && productId !== id) {\n        response.body = { issue: [{ error: 'Param id and body _id should be the same' }] };\n        response.status = 400; // bad request\n        return;\n    }\n    if (!productId) {\n        await createProduct(product, response);\n    } else {\n        const updatedCount = await productStore.update({ _id: id }, product);\n        if (updatedCount === 1) {\n            response.body = product;\n            response.status = 200; // ok\n        } else {\n            response.body = { issue: [{ error: 'Resource no longer exists' }] };\n            response.status = 405; // method not allowed\n        }\n    }\n});\n\nrouter.del('/:id', async (ctx) => {\n    await productStore.remove({ _id: ctx.params.id });\n    ctx.response.status = 204; // no content\n});\n","import dataStore from 'nedb-promise';\n\nexport class ProductStore {\n    constructor({ filename, autoload }) {\n        this.store = dataStore({ filename, autoload });\n    }\n\n    async find(props) {\n        return this.store.find(props);\n    }\n\n    async findOne(props) {\n        return this.store.findOne(props);\n    }\n\n    async insert(product) {\n        let productName = product.name;\n        if (!productName) { // validation\n            throw new Error('Missing product name property')\n        }\n        return this.store.insert(product);\n    };\n\n    async update(props, product) {\n        return this.store.update(props, product);\n    }\n\n    async remove(props) {\n        return this.store.remove(props);\n    }\n}\n\nexport default new ProductStore({ filename: './db/products.json', autoload: true });\n","export * from './router';\r\n","import Router from 'koa-router';\r\nimport userStore from '../auth/store';\r\n\r\nexport const router = new Router();\r\n\r\nrouter.get('/', async (ctx) => {\r\n  const response = ctx.response;\r\n  response.body = await userStore.find({});\r\n  response.status = 200; // ok\r\n});\r\n\r\nrouter.get('/:id', async (ctx) => {\r\n  const user = await userStore.findOne({ _id: ctx.params.id });\r\n  const response = ctx.response;\r\n  if (user) {\r\n    response.body = user;\r\n    response.status = 200; // ok\r\n  } else {\r\n    response.status = 404; // not found\r\n  }\r\n});\r\n\r\nconst createUser = async (user, response) => {\r\n  try {\r\n    response.body = await userStore.insert(user);\r\n    response.status = 201; // created\r\n  } catch (err) {\r\n    response.body = { issue: [{ error: err.message }] };\r\n    response.status = 400; // bad request\r\n  }\r\n};\r\n\r\nrouter.post('/', async (ctx) => await createUser(ctx.request.body, ctx.response));\r\n\r\nrouter.put('/:id', async (ctx) => {\r\n  const user = ctx.request.body;\r\n  const id = ctx.params.id;\r\n  const userId = user._id;\r\n  const response = ctx.response;\r\n  if (userId && userId !== id) {\r\n    response.body = { issue: [{ error: 'Param id and body _id should be the same' }] };\r\n    response.status = 400; // bad request\r\n    return;\r\n  }\r\n  if (!userId) {\r\n    await createUser(user, response);\r\n  } else {\r\n    const updatedCount = await userStore.update({ _id: id }, user);\r\n    if (updatedCount === 1) {\r\n      response.body = user;\r\n      response.status = 200; // ok\r\n    } else {\r\n      response.body = { issue: [{ error: 'Resource no longer exists' }] };\r\n      response.status = 405; // method not allowed\r\n    }\r\n  }\r\n});\r\n\r\nrouter.del('/:id', async (ctx) => {\r\n  await userStore.remove({ _id: ctx.params.id });\r\n  ctx.response.status = 204; // no content\r\n});\r\n","export const jwtConfig = { secret: 'my-secret' };\r\n","export * from './middlewares';\r\nexport * from './constants';\r\n","export const exceptionHandler = async (ctx, next) => {\r\n  try {\r\n    return await next();\r\n  } catch (err) {\r\n    ctx.body = { message: err.message || 'Unexpected error.' };\r\n    ctx.status = err.status || 500;\r\n  }\r\n};\r\n\r\nexport const timingLogger = async (ctx, next) => {\r\n  const start = Date.now();\r\n  await next();\r\n  console.log(`${ctx.method} ${ctx.url} => ${ctx.response.status}, ${Date.now() - start}ms`);\r\n};\r\n","module.exports = require(\"@koa/cors\");","module.exports = require(\"@panderalabs/koa-pageable\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-jwt\");","module.exports = require(\"koa-router\");","module.exports = require(\"nedb-promise\");"],"sourceRoot":""}